name: Deploy Javadoc

on:
  push

jobs:
  makedoc:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy JavaDoc
        uses: MathieuSoysal/Javadoc-publisher.yml@v2.4.0
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          javadoc-branch: javadoc
          java-version: 17
          target-folder: javadoc
          project: gradle
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: checkout source
        uses: actions/checkout@v3
      - name: Get next version
        uses: reecetech/version-increment@2023.9.3
        id: version
        with:
          scheme: semver
          increment: patch
      - name: Setup JDK
        uses: actions/setup-java@v3
        with:
          distribution: "temurin"
          java-version: 17
      - name: shadowJar
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: release-candidate
          arguments: shadowJar
      - run: echo ${{ steps.version.outputs.version }}
      - name: Nexus Repo Publish
        uses: sonatype-nexus-community/nexus-repo-github-action@master
        with:
          serverUrl: https://gradle.phoenix.is-a.dev
          username: admin
          password: ${{ secrets.password }}
          format: maven2
          repository: maven-releases
          coordinates: groupId=net.phoenix artifactId=eventemitter version=1.0.0
          assets: extension=jar
          filename: ./build/libs/EventEmitter-1.0-all.jar